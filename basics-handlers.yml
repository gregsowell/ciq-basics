---
- name: Install Web Server
  hosts: basics-host

  tasks:
  - name: Install Apache
    ansible.builtin.dnf:
      name: httpd
      state: latest
    register: httpd_install
      
  - name: Restart httpd
    ansible.builtin.service:
      name: httpd
      state=restarted
    when: httpd_install.changed

  - name: Apache alternate port
    lineinfile: dest=/etc/apache2/ports.conf 
      regexp="^Listen " 
      line="Listen {{ http_port }}" 
      state=present
    register: alt_port
      
  - name: Restart httpd
    ansible.builtin.service:
      name: httpd
      state: restarted
    when: alt_port.changed
